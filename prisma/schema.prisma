generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model address {
  ssn      String @db.Char(8)
  commune  String @db.VarChar(30)
  district String @db.VarChar(30)
  province String @db.VarChar(30)
  people   people @relation(fields: [ssn], references: [ssn], onDelete: Cascade, map: "fk_address")

  @@id([ssn, commune, district, province])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model building {
  building_id         String               @id @db.Char(5)
  building_name       String               @db.Char(5)
  floors              Int
  rooms               Int
  has_air_conditioner Boolean
  sponsor             String?              @db.VarChar(100)
  construction_date   DateTime             @db.Date
  last_renovation     DateTime?            @db.Date
  building_equipment  building_equipment[]
  room                room[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model building_equipment {
  building_id     String          @db.Char(5)
  equipment_id    String          @db.Char(10)
  quantity        Int
  building        building        @relation(fields: [building_id], references: [building_id], onDelete: Cascade, map: "fk_building_equipment_building")
  large_equipment large_equipment @relation(fields: [equipment_id], references: [equipment_id], onDelete: Cascade, map: "fk_building_equipment_equipment")

  @@id([building_id, equipment_id])
  @@index([equipment_id], map: "fk_building_equipment_equipment")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model disciplinary_action {
  action_id          String               @id @db.VarChar(20)
  action_type        String               @db.VarChar(50)
  reason             String               @db.Text
  decision_date      DateTime             @db.Date
  effective_from     DateTime             @db.Date
  effective_to       DateTime?            @db.Date
  severity_level     String?              @db.VarChar(20)
  status             String?              @db.VarChar(20)
  discipline_staff   discipline_staff[]
  student_discipline student_discipline[]
}

model discipline_staff {
  action_id           String              @db.VarChar(20)
  essn                String              @db.Char(8)
  disciplinary_action disciplinary_action @relation(fields: [action_id], references: [action_id], onDelete: Cascade, map: "fk_disciplineStaff_d")
  manager_employee    manager_employee    @relation(fields: [essn], references: [essn], onDelete: Cascade, map: "fk_disciplineStaff_m")

  @@id([action_id, essn])
  @@index([essn], map: "fk_disciplineStaff_m")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model dormitory_card {
  number        String        @id @db.Char(7)
  start_date    DateTime?     @db.Date
  end_date      DateTime?     @db.Date
  id_card       String        @db.Char(8)
  validity      Boolean?      @default(true)
  identity_card identity_card @relation(fields: [number], references: [id], onDelete: Cascade, map: "dormitory_card_ibfk_1")
  student       student       @relation(fields: [id_card], references: [sssn], onDelete: Cascade, map: "dormitory_card_ibfk_2")

  @@index([id_card], map: "id_card")
}

model email {
  ssn    String @db.Char(8)
  email  String @db.VarChar(50)
  people people @relation(fields: [ssn], references: [ssn], onDelete: Cascade, map: "fk_email")

  @@id([ssn, email])
}

model employee {
  essn             String            @id @db.Char(8)
  salary           Decimal?          @db.Decimal(10, 0)
  emp_id           String?           @db.Char(7)
  people           people            @relation(fields: [essn], references: [ssn], onDelete: Cascade, map: "fk_essn")
  employee_card    employee_card[]
  manager_employee manager_employee?
  medical_employee medical_employee?
  other_employee   other_employee?
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model employee_card {
  number        String        @id @db.Char(7)
  start_date    DateTime?     @db.Date
  end_date      DateTime?     @db.Date
  id_card       String        @db.Char(8)
  employee_type String?       @db.Char(10)
  identity_card identity_card @relation(fields: [number], references: [id], onDelete: Cascade, map: "employee_card_ibfk_1")
  employee      employee      @relation(fields: [id_card], references: [essn], onDelete: Cascade, map: "employee_card_ibfk_2")

  @@index([id_card], map: "id_card")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model health_room {
  building_id      String                       @db.Char(5)
  room_id          String                       @db.Char(5)
  num_of_staff     Int                          @default(0)
  start_time       DateTime                     @db.Time(0)
  end_time         DateTime                     @db.Time(0)
  equipment_status health_room_equipment_status
  room             room                         @relation(fields: [building_id, room_id], references: [building_id, room_id], onDelete: Cascade, map: "fk_health_room")
  medical_employee medical_employee[]

  @@id([building_id, room_id])
}

model identity_card {
  id             String          @id @db.Char(7)
  issued_date    DateTime        @db.Date
  dormitory_card dormitory_card?
  employee_card  employee_card?
}

model large_equipment {
  equipment_id       String                           @id @db.Char(10)
  equipment_name     String                           @db.VarChar(100)
  equipment_type     String                           @db.VarChar(50)
  equipment_status   large_equipment_equipment_status
  purchase_date      DateTime                         @db.Date
  purchase_location  String?                          @db.VarChar(255)
  building_equipment building_equipment[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model living_room {
  building_id             String    @db.Char(5)
  room_id                 String    @db.Char(5)
  max_num_of_students     Int
  current_num_of_students Int       @default(0)
  rental_price            Decimal   @db.Decimal(10, 2)
  occupancy_rate          Decimal   @default(0.00) @db.Decimal(5, 2)
  student                 student[]

  @@id([building_id, room_id])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model management_room {
  building_id      String             @db.Char(5)
  room_id          String             @db.Char(5)
  num_of_staff     Int                @default(0)
  start_time       DateTime           @db.Time(0)
  end_time         DateTime           @db.Time(0)
  room             room               @relation(fields: [building_id, room_id], references: [building_id, room_id], onDelete: Cascade, map: "fk_mgmt_room")
  manager_employee manager_employee[]

  @@id([building_id, room_id])
}

model manager_degree {
  essn             String           @db.Char(8)
  degree           String           @db.VarChar(50)
  manager_employee manager_employee @relation(fields: [essn], references: [essn], onDelete: Cascade, map: "fk_mgr_deg")

  @@id([essn, degree])
}

model manager_dorm {
  user_name String @db.VarChar(50)
  password  String @db.VarChar(255)

  @@id([user_name, password])
}

model manager_employee {
  essn             String             @id @db.Char(8)
  room_id          String?            @db.Char(5)
  building_id      String?            @db.Char(5)
  experience       Decimal?           @db.Decimal(2, 0)
  discipline_staff discipline_staff[]
  manager_degree   manager_degree[]
  management_room  management_room?   @relation(fields: [building_id, room_id], references: [building_id, room_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_manager_employee_room")
  employee         employee           @relation(fields: [essn], references: [essn], onDelete: Cascade, map: "fk_mgr_essn")

  @@index([building_id, room_id], map: "fk_manager_employee_room")
}

model medical_degree {
  essn             String           @db.Char(8)
  degree           String           @db.VarChar(50)
  medical_employee medical_employee @relation(fields: [essn], references: [essn], onDelete: Cascade, map: "fk_med_deg")

  @@id([essn, degree])
}

model medical_employee {
  essn           String           @id @db.Char(8)
  room_id        String?          @db.Char(5)
  building_id    String?          @db.Char(5)
  experience     Decimal?         @db.Decimal(2, 0)
  medical_degree medical_degree[]
  employee       employee         @relation(fields: [essn], references: [essn], onDelete: Cascade, map: "fk_med_essn")
  health_room    health_room?     @relation(fields: [building_id, room_id], references: [building_id, room_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_medical_employee_room")

  @@index([building_id, room_id], map: "fk_medical_employee_room")
}

model other_employee {
  essn                     String                     @id @db.Char(8)
  room_id                  String?                    @db.Char(5)
  building_id              String?                    @db.Char(5)
  type_work                String?                    @db.VarChar(20)
  employee                 employee                   @relation(fields: [essn], references: [essn], onDelete: Cascade, map: "fk_oth_essn")
  other_room               other_room?                @relation(fields: [building_id, room_id], references: [building_id, room_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_other_employee_room")
  other_employee_time_work other_employee_time_work[]

  @@index([building_id, room_id], map: "fk_other_employee_room")
}

model other_employee_time_work {
  essn           String                             @db.Char(8)
  date_work      other_employee_time_work_date_work
  time_start     DateTime                           @db.Time(0)
  time_end       DateTime                           @db.Time(0)
  other_employee other_employee                     @relation(fields: [essn], references: [essn], onDelete: NoAction, onUpdate: NoAction, map: "fk_other_time")

  @@id([essn, date_work, time_start, time_end])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model other_room {
  building_id    String           @db.Char(5)
  room_id        String           @db.Char(5)
  room_type      String           @db.VarChar(100)
  start_time     DateTime         @db.Time(0)
  end_time       DateTime         @db.Time(0)
  num_of_staff   Int              @default(0)
  other_employee other_employee[]
  room           room             @relation(fields: [building_id, room_id], references: [building_id, room_id], onDelete: Cascade, map: "fk_other_room")

  @@id([building_id, room_id])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model people {
  ssn          String         @id @db.Char(8)
  last_name    String         @db.VarChar(20)
  first_name   String         @db.VarChar(20)
  birthday     DateTime       @db.Date
  sex          String?        @db.Char(1)
  health_state String?        @db.VarChar(100)
  ethnic_group String?        @db.VarChar(30)
  address      address[]
  email        email[]
  employee     employee?
  phone_number phone_number[]
  student      student?
}

model phone_number {
  ssn          String @db.Char(8)
  phone_number String @db.Char(10)
  people       people @relation(fields: [ssn], references: [ssn], onDelete: Cascade, map: "fk_phone_number")

  @@id([ssn, phone_number])
}

model relative {
  sssn         String   @db.Char(8)
  fname        String   @db.VarChar(20)
  lname        String   @db.VarChar(20)
  birthday     DateTime @db.Date
  relationship String   @db.VarChar(50)
  address      String   @db.VarChar(255)
  phone_number String?  @db.Char(10)
  job          String?  @db.VarChar(50)
  student      student  @relation(fields: [sssn], references: [sssn], onDelete: Cascade, map: "fk_relative")

  @@id([sssn, fname, lname])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model room {
  building_id     String           @db.Char(5)
  room_id         String           @db.Char(5)
  room_status     room_room_status
  room_area       Decimal          @db.Decimal(10, 2)
  health_room     health_room?
  management_room management_room?
  other_room      other_room?
  building        building         @relation(fields: [building_id], references: [building_id], onDelete: Cascade, map: "fk_room_building")

  @@id([building_id, room_id])
}

model student {
  sssn                 String               @id @db.Char(8)
  student_id           String               @db.Char(7)
  has_health_insurance Boolean
  study_status         String?              @db.VarChar(20)
  class_name           String?              @db.VarChar(20)
  faculty              String?              @db.VarChar(50)
  building_id          String?              @db.Char(5)
  room_id              String?              @db.Char(5)
  dormitory_card       dormitory_card[]
  relative             relative[]
  people               people               @relation(fields: [sssn], references: [ssn], onDelete: Cascade, map: "fk_student_p")
  living_room          living_room?         @relation(fields: [building_id, room_id], references: [building_id, room_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_student_room")
  student_discipline   student_discipline[]

  @@index([building_id, room_id], map: "fk_student_room")
}

model student_discipline {
  action_id           String              @db.VarChar(20)
  sssn                String              @db.Char(8)
  disciplinary_action disciplinary_action @relation(fields: [action_id], references: [action_id], onDelete: Cascade, map: "fk_student_discipline_d")
  student             student             @relation(fields: [sssn], references: [sssn], onDelete: Cascade, map: "fk_student_discipline_s")

  @@id([action_id, sssn])
  @@index([sssn], map: "fk_student_discipline_s")
}

enum other_employee_time_work_date_work {
  monday
  tuesday
  wednesday
  thursday
  friday
  saturday
  sunday
  other
}

enum room_room_status {
  Available
  Occupied
  Under_Maintenance @map("Under Maintenance")
}

enum large_equipment_equipment_status {
  Working
  Damaged
  Under_Repair @map("Under Repair")
}

enum health_room_equipment_status {
  Good
  Under_Repair  @map("Under Repair")
  Not_Available @map("Not Available")
}
